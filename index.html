<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Flange Management  - Cadastro</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Site styles -->
    <link rel="stylesheet" href="style/style.css">

    <!-- jsPDF (para gerar PDF) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- IMEDIATO: verifica login -> redireciona se necess√°rio -->
    <script>
        (function () {
            const userId = localStorage.getItem('user_id');
            if (!userId) {
                // redireciona imediatamente ao login se n√£o houver user_id
                window.location.replace('login.html');
            }
            // caso exista, deixa a p√°gina carregar; matr√≠cula ser√° preenchida no DOMContentLoaded
        })();
    </script>
</head>

<body>
    <nav class="navbar fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Sistema de Punchlist</a>
            <div class="ms-auto">
                <button id="logoutBtn" class="btn btn-light">Sair</button>
            </div>
        </div>
    </nav>

    <main class="container main-card">
        <h2>Registro de Punchlist</h2>

        <div id="alertMsg" class="alert alert-danger" style="display:none;"></div>
        <div id="successMsg" class="alert alert-success" style="display:none;"></div>

        <form id="formCadastro" novalidate>
            <!-- 1. Bot√£o de foto -->
            <div class="mb-3">
                <label class="form-label">Foto</label>
                <div class="d-grid">
                    <button type="button" id="btnCadastrar" class="btn btn-secondary">üì∏ Cadastrar Foto</button>
                </div>
                <input id="inputCamera" type="file" accept="image/*" capture="environment" style="display:none;">
                <img id="fotoPreview" class="foto-preview" alt="Foto registrada" style="display:none;">
            </div>

            <!-- 2. Matr√≠cula (auto preenchida) -->
            <div class="mb-3">
                <label class="form-label">Matr√≠cula</label>
                <input id="matricula" type="text" class="form-control" required>
            </div>

            <!-- 3. Obra -->
            <div class="mb-3">
                <label class="form-label">Projeto</label>
                <input id="obra" type="text" class="form-control" required>
            </div>

            <!-- 4. Projeto -->
            <div class="mb-3">
                <label class="form-label">M√≥dulo</label>
                <input id="projeto" type="text" class="form-control" required>
            </div>

            <!-- 5. N√∫mero da Linha -->
            <div class="mb-3">
                <label class="form-label">Nome da pasta</label>
                <input id="linha" type="text" class="form-control" required>
            </div>

            <!-- 6. N√∫mero da Junta -->
            <div class="mb-3">
                <label class="form-label">Data da Verifica√ß√£o</label>
                <input id="junta" type="text" class="form-control" required>
            </div>

            <!-- 7. Observa√ß√£o (opcional) -->
            <div class="mb-3">
                <label class="form-label">Observa√ß√£o (opcional)</label>
                <textarea id="observacao" class="form-control" rows="3"></textarea>
            </div>

            <!-- Nome do arquivo (auto) -->
            <div class="mb-3">
                <label class="form-label">Nome do Arquivo PDF</label>
                <input id="nomeArquivo" class="form-control" readonly>
                <div class="small-note">O nome do arquivo ser√° preenchido automaticamente com o N√∫mero da pasta.</div>
            </div>

            <!-- Bot√µes -->
            <div class="d-grid gap-2 mb-2">
                <button id="btnGerar" type="submit" class="btn btn-primary" disabled>Gerar PDF</button>
            </div>
        </form>

        <!-- Preview do PDF (iframe) -->
        <div id="pdfPreviewContainer" style="display:none; margin-top:18px;">
            <h5>Pr√©-visualiza√ß√£o do PDF</h5>
            <iframe id="pdfPreview"></iframe>
        </div>
    </main>
        <footer>
            <p>&copy; 2025 Flanje Meneger. Todos os direitos reservados.
                <br> Desenvolvido por Lpc.dev sistemas
            </p>
        </footer>
    <!-- script principal -->
    <script src="script/script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>